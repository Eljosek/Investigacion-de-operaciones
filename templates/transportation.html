{% extends "base.html" %}

{% block title %}Modelo de Transporte - Programación Lineal{% endblock %}

{% block content %}
<div class="row method-transport">
    <div class="col-lg-8 mx-auto">
        <div class="text-center mb-5">
            <h1 class="display-4 text-method-transport">
                <i class="fas fa-truck-moving text-method-transport"></i> Modelo de Transporte
            </h1>
            <p class="lead text-muted">
                Optimiza la distribución de recursos desde orígenes a destinos minimizando costos
            </p>
        </div>

        <div class="card shadow-lg">
            <div class="card-header bg-method-transport text-white">
                <h3 class="card-title mb-0">
                    <i class="fas fa-edit"></i> Ingresa tu problema de transporte
                </h3>
            </div>
            
            <div class="card-body">
                <form action="{{ url_for('transportation_method') }}" method="POST" id="transportForm">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Formato:</strong> Ingrese la matriz de costos (una fila por línea, valores separados por espacios),
                        luego las ofertas y demandas separadas por espacios.
                    </div>
                    
                    <div class="mb-4">
                        <label for="costsText" class="form-label">
                            <i class="fas fa-table"></i> <strong>Matriz de Costos</strong>
                        </label>
                        <textarea class="form-control form-control-lg font-monospace" 
                                  id="costsText" 
                                  name="costs_text" 
                                  rows="6" 
                                  placeholder="Ejemplo 44:&#10;5 2 7 3&#10;3 6 6 1&#10;6 1 2 4&#10;4 3 6 6"
                                  required></textarea>
                        <div class="form-text">
                            <i class="fas fa-info-circle"></i> Cada fila en una línea, valores separados por espacios
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <label for="supplyText" class="form-label">
                                <i class="fas fa-industry"></i> <strong>Ofertas (Orígenes)</strong>
                            </label>
                            <input type="text" 
                                   class="form-control form-control-lg font-monospace" 
                                   id="supplyText"
                                   name="supply_text"
                                   placeholder="Ejemplo: 80 30 60 45"
                                   required>
                            <div class="form-text">
                                <i class="fas fa-info-circle"></i> Valores separados por espacios
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <label for="demandText" class="form-label">
                                <i class="fas fa-store"></i> <strong>Demandas (Destinos)</strong>
                            </label>
                            <input type="text" 
                                   class="form-control form-control-lg font-monospace" 
                                   id="demandText"
                                   name="demand_text"
                                   placeholder="Ejemplo: 70 40 70 35"
                                   required>
                            <div class="form-text">
                                <i class="fas fa-info-circle"></i> Valores separados por espacios
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="method" class="form-label">
                            <i class="fas fa-cogs"></i> <strong>Método de Solución</strong>
                        </label>
                        <select class="form-select" name="method" id="method">
                            <option value="northwest">Esquina Noroeste (Northwest Corner)</option>
                            <option value="minimum_cost">Costo Mínimo (Minimum Cost)</option>
                            <option value="vogel">Aproximación de Vogel (VAM)</option>
                            <option value="all">Comparar los 3 métodos</option>
                        </select>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-danger btn-lg">
                            <i class="fas fa-calculator"></i> Resolver con Modelo de Transporte
                        </button>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-secondary" onclick="clearTransportForm()">
                                <i class="fas fa-eraser"></i> Limpiar
                            </button>
                            <button type="button" class="btn btn-outline-info" onclick="loadTransportExample()">
                                <i class="fas fa-lightbulb"></i> Cargar Ejemplo
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="alert alert-info mt-4 shadow-sm">
            <h5><i class="fas fa-info-circle"></i> Ayuda Rápida</h5>
            <ul class="mb-0 small">
                <li><strong>Matriz de costos:</strong> Una fila por línea, costos separados por espacios</li>
                <li><strong>Ofertas:</strong> Cantidades disponibles en cada origen (separadas por espacios)</li>
                <li><strong>Demandas:</strong> Cantidades requeridas en cada destino (separadas por espacios)</li>
                <li><strong>Balance:</strong> La suma de ofertas debe igualar la suma de demandas</li>
            </ul>
        </div>
    </div>
</div>

<script>
function clearTransportForm() {
    document.getElementById('transportForm').reset();
}

function loadTransportExample() {
    document.getElementById('costsText').value = '5 2 7 3\n3 6 6 1\n6 1 2 4\n4 3 6 6';
    document.getElementById('supplyText').value = '80 30 60 45';
    document.getElementById('demandText').value = '70 40 70 35';
    
    const alert = document.createElement('div');
    alert.className = 'alert alert-success alert-dismissible fade show mt-3';
    alert.innerHTML = '<i class="fas fa-check-circle"></i> <strong>Ejemplo cargado!</strong> <button type="button" class="btn-close" data-bs-dismiss="alert"></button>';
    document.querySelector('.card-body').insertBefore(alert, document.getElementById('transportForm'));
    setTimeout(() => alert.remove(), 3000);
}

window.addEventListener('load', function() {
    const exampleCosts = localStorage.getItem('example_costs');
    const exampleSupply = localStorage.getItem('example_supply');
    const exampleDemand = localStorage.getItem('example_demand');
    
    if (exampleCosts && exampleSupply && exampleDemand) {
        try {
            const costs = JSON.parse(exampleCosts);
            const supply = JSON.parse(exampleSupply);
            const demand = JSON.parse(exampleDemand);
            
            document.getElementById('costsText').value = costs.map(row => row.join(' ')).join('\n');
            document.getElementById('supplyText').value = supply.join(' ');
            document.getElementById('demandText').value = demand.join(' ');
            
            localStorage.removeItem('example_costs');
            localStorage.removeItem('example_supply');
            localStorage.removeItem('example_demand');
        } catch (e) {
            console.error('Error:', e);
        }
    }
});
</script>
{% endblock %}
